var $ = jQuery.noConflict();
pic1 = new Image(16, 16);
pic1.src = rootWebService + "assets/images/loader.gif";
var pict = rootWebService + "assets/images/loader.gif";

//Check ID username
$(document).ready(function() {
    $("#username").on("keyup change", function() {
        var us = $("#username").val();
        var usernameRegex = /^([a-zA-Z0-9]{6,30})$/;
        if (us.length >= 6 && us.length <= 30) {
            if (us.match(usernameRegex)) {
                $("#statusUsername").html(
                    '<img src="' +
                    pict +
                    '" align="absmiddle">&nbsp;Memeriksa Ketersediaan...'
                );

                $.ajax({
                    type: "POST",
                    url: rootWebService + "Admin/CheckUser",
                    data: "username=" + us,
                    success: function(response) {
                        var msg = response.msg;
                        if (msg === "US-OK") {
                            $("#username").removeClass("object_error"); // if necessary
                            $("#username").addClass("object_ok");
                            $("#statusUsername").html(
                                '<font class="font_object_ok">Username ' +
                                us +
                                " Tersedia</font>"
                            );
                        } else if (msg === "US-NO") {
                            $("#username").removeClass("object_ok"); // if necessary
                            $("#username").addClass("object_error");
                            $("#statusUsername").html(
                                '<font class="font_object_error">Username <strong>' +
                                us +
                                "</strong> sudah digunakan</font>"
                            );
                        } else if (msg === "US-Error") {
                            Notiflix.Report.Failure(
                                "Terjadi Kesalahan !!",
                                "Terjadi Kesalahan, silahkan muat ulang halaman !",
                                "Tutup"
                            );
                            $("#statusUsername").html(
                                '<font class="font_object_error"><strong>Terjadi Kesalahan</strong></font>'
                            );
                        }
                    },
                    error: function(xhr, ajaxOption, thrownError) {
                        Notiflix.Report.Failure(
                            "Terjadi Kesalahan !",
                            "Server tidak merespon permintaan !! - System<br>",
                            "Tutup"
                        );
                    }, //error
                });
            } else {
                $("#statusUsername").html(
                    '<font class="font_object_error">Username tidak valid</font>'
                );
                $("#username").removeClass("object_ok"); // if necessary
                $("#username").addClass("object_error");
            }
        } else {
            $("#statusUsername").html(
                '<font class="font_object_error">' +
                "Username harus lebih dari <strong>6</strong> karakter dan tidak boleh lebih dari <strong>30</strong> karakter.</font>"
            );
            $("#username").removeClass("object_ok"); // if necessary
            $("#username").addClass("object_error");
        }
    });
});

//Check NIP
$(document).ready(function() {
    $("#nipuser").on("keyup change", function() {
        var nip = $("#nipuser").val();

        if (nip.length == 10) {
            $("#statusNIK").html(
                '<img src="' +
                pict +
                '" align="absmiddle">&nbsp;Memeriksa Ketersediaan...'
            );

            $.ajax({
                type: "POST",
                url: rootWebService + "Admin/CheckNIP",
                data: "nip=" + nip,
                success: function(response) {
                    var msg = response.msg;
                    if (msg === "NIP-OK") {
                        $("#nipuser").removeClass("object_error"); // if necessary
                        $("#nipuser").addClass("object_ok");
                        $("#statusNIP").html(
                            '<font class="font_object_ok">NIP ' + nip + " Tersedia</font>"
                        );
                    } else if (msg === "NIP-NO") {
                        $("#nipuser").removeClass("object_ok"); // if necessary
                        $("#nipuser").addClass("object_error");
                        $("#statusNIP").html(
                            '<font class="font_object_error">NIP <strong>' +
                            nip +
                            "</strong> sudah digunakan</font>"
                        );
                    } else if (msg === "NIP-Error") {
                        Notiflix.Report.Failure(
                            "Terjadi Kesalahan !!",
                            "Terjadi Kesalahan, silahkan muat ulang halaman !",
                            "Tutup"
                        );
                        $("#statusNIP").html(
                            '<font class="font_object_error"><strong>Terjadi Kesalahan</strong></font>'
                        );
                    }
                },
                error: function(xhr, ajaxOption, thrownError) {
                    Notiflix.Report.Failure(
                        "Terjadi Kesalahan !",
                        "Server tidak merespon permintaan !! - System<br>",
                        "Tutup"
                    );
                }, //error
            });
        } else {
            $("#statusNIP").html(
                '<font class="font_object_error">' +
                "NIP user harus <strong>10</strong> karakter.</font>"
            );
            $("#nipuser").removeClass("object_ok"); // if necessary
            $("#nipuser").addClass("object_error");
        }
    });
});

//Check Nama
$(document).ready(function() {
    $("#nama").on("keyup change", function() {
        var regexname = /^([a-zA-Z\s]{3,30})$/;
        var nama = $("#nama").val();

        if (nama.length >= 3) {
            if (!nama.match(regexname)) {
                // there is a mismatch, hence show the error message
                $("#statusNama").html(
                    '<font class="font_object_error">Nama tidak valid !</font>'
                );
                $("#nama").removeClass("object_ok"); // if necessary
                $("#nama").addClass("object_error");
            } else {
                // else, do not display message
                $("#statusNama").html("");
                $("#nama").removeClass("object_error"); // if necessary
                $("#nama").addClass("object_ok");
            }
        } else {
            $("#statusNama").html(
                '<font class="font_object_error">' +
                "Nama Minimal 3 Karakter dan maksimal 30 karakter</font>"
            );
            $("#nama").removeClass("object_ok"); // if necessary
            $("#nama").addClass("object_error");
        }
    });
});

//Check Email
$(document).ready(function() {
    $("#email").on("keyup change", function() {
        var regexemail = /^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i;
        var email = $("#email").val();

        if (!email.match(regexemail)) {
            // there is a mismatch, hence show the error message
            $("#statusEmail").html(
                '<font class="font_object_error">Email Tidak Valid !</font>'
            );
            $("#email").removeClass("object_ok"); // if necessary
            $("#email").addClass("object_error");
        } else {
            // else, do not display message
            $("#statusEmail").html("");
            $("#email").removeClass("object_error"); // if necessary
            $("#email").addClass("object_ok");
        }
    });
});

//Check Nomer HP
$(document).ready(function() {
    $("#tlp").on("keyup change", function() {
        var regextlp = /\(?([0-9]{3})\)?([ .-]?)([0-9]{3})\2([0-9]{4})/;
        var tlp = $("#tlp").val();

        if (!tlp.match(regextlp)) {
            // there is a mismatch, hence show the error message
            $("#statusTlp").html(
                '<font class="font_object_error">Nomer Telepon Tidak Valid !</font>'
            );
            $("#tlp").removeClass("object_ok"); // if necessary
            $("#tlp").addClass("object_error");
        } else {
            // else, do not display message
            $("#statusTlp").html("");
            $("#tlp").removeClass("object_error"); // if necessary
            $("#tlp").addClass("object_ok");
        }
    });
});

//Check Alamat
$(document).ready(function() {
    $("#alamat").on("keyup change", function() {
        var alamat = $("#alamat").val();

        if (alamat.length >= 10) {
            $("#statusAlamat").html("");
            $("#alamat").removeClass("object_error"); // if necessary
            $("#alamat").addClass("object_ok");
        } else {
            $("#statusAlamat").html(
                '<font class="font_object_error">Alamat Harus Lebih Dari 10 Karakter</font>'
            );
            $("#alamat").removeClass("object_ok"); // if necessary
            $("#alamat").addClass("object_error");
        }
    });
});

//Check Tanggal
$(document).ready(function() {
    $("#tanggal").on("keyup change", function() {
        var tanggal = $("#tanggal").val();
        var regexdate = /^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/;

        if (!tanggal.match(regexdate)) {
            $("#tanggal").removeClass("object_ok"); // if necessary
            $("#tanggal").addClass("object_error");
        } else {
            $("#tanggal").removeClass("object_error"); // if necessary
            $("#tanggal").addClass("object_ok");
        }
    });
});

//Check Password
$(document).ready(function() {
    $("#password").on("keyup change", function() {
        var password = $("#password").val();

        if (password.length >= 6 && password.length <= 30) {
            $("#statusPassword").html("");
            $("#password").removeClass("object_error"); // if necessary
            $("#password").addClass("object_ok");
        } else {
            $("#statusPassword").html(
                '<font class="font_object_error">password Harus Lebih Dari 6 Karakter dan tidak lebih dari 30 karakter</font>'
            );
            $("#password").removeClass("object_ok"); // if necessary
            $("#password").addClass("object_error");
        }
    });
});

$(function() {
    var addPage = $("#adduser-page");

    addPage.find("form").submit(function(e) {
        // Preventing form submissions. If you implement
        // a backend, you might want to remove this code
        e.preventDefault();
        $.ajax({
            url: rootWebService + "Admin/AddUser",
            type: "POST",
            cache: false,
            async: false,
            contentType: false,
            processData: false,
            data: new FormData(this),
            success: function(response) {
                var msg = response.msg;
                var err = response.err;

                if (msg === "OK") {
                    Notiflix.Report.Success(
                        "Tambah Caddy Berhasil",
                        "Data Caddy yang baru berhasil ditambahkan",
                        "Tutup"
                    );
                    $("form :input").val("");
                    setTimeout(function() {
                        window.location.href = rootWebService + "Admin/";
                    }, 2000);
                } else if (msg === "KOSONG") {
                    Notiflix.Notify.Warning("Data tidak boleh kosong/tidak valid !");
                } else if (msg === "SHORT_NAME") {
                    Notiflix.Notify.Warning(
                        "Nama minimal 3 huruf dan maksimal 30 huruf !"
                    );
                } else if (msg === "INVALID_NAME") {
                    Notiflix.Notify.Warning(
                        "Nama tidak boleh menggunakan karakter ilegal !"
                    );
                } else if (msg === "INVALID_NIP") {
                    Notiflix.Notify.Warning("NIP tidak benar !");
                } else if (msg === "NO_UNIQ_NIP") {
                    Notiflix.Notify.Failure("NIP sudah digunakan !");
                } else if (msg === "NO_UNIQ_USERNAME") {
                    Notiflix.Notify.Failure("Username sudah digunakan !");
                } else if (msg === "INVALID_EMAIL") {
                    Notiflix.Notify.Failure("Format email salah !");
                } else if (msg === "FAIL_UPLOAD") {
                    Notiflix.Report.Warning("Terjadi Kesalahan !", err, "Tutup");
                } else if (msg === "SHORT_USERNAME") {
                    Notiflix.Notify.Warning(
                        "Username 6 karakter dan maksimal 30 karakter !"
                    );
                } else if (msg === "INVALID_USERNAME") {
                    Notiflix.Notify.Warning(
                        "Username tidak boleh menggunakan karakter ilegal !"
                    );
                } else if (msg === "SHORT_PASSWORD") {
                    Notiflix.Notify.Warning(
                        "Password 6 karakter dan maksimal 30 karakter !"
                    );
                }
            }, //success
            error: function(xhr, ajaxOption, thrownError) {
                Notiflix.Report.Failure(
                    "Terjadi Kesalahan !",
                    "Server tidak merespon permintaan !! - System<br>",
                    "Tutup"
                );
            }, //error
        }); //ajax
    });
});