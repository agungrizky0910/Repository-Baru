var $ = jQuery.noConflict();
pic1 = new Image(16, 16);
pic1.src = rootWebService + "assets/images/loader.gif";
var pict = rootWebService + "assets/images/loader.gif";
tampil_gambar();

function tampil_gambar() {
    $.ajax({
        type: "GET",
        url: rootWebService + "Admin/LoadGambar/" + nip_encode,
        async: true,
        dataType: "json",
        success: function(response) {
            var hasil = response.hasil;
            $("#foto-profil").html(hasil);
        },
    });
}

//Check NIP
$(document).ready(function() {
    $("#nipuser").on("keyup change", function() {
        var nip = $("#nipuser").val();

        if (nip.length == 10) {
            $("#statusNIK").html(
                '<img src="' +
                pict +
                '" align="absmiddle">&nbsp;Memeriksa Ketersediaan...'
            );

            $.ajax({
                type: "POST",
                url: rootWebService + "Admin/CheckNIP",
                data: "nip=" + nip,
                success: function(response) {
                    var msg = response.msg;
                    if (msg === "NIP-OK") {
                        $("#nipuser").removeClass("object_error"); // if necessary
                        $("#nipuser").addClass("object_ok");
                        $("#statusNIP").html(
                            '<font class="font_object_ok">NIP ' + nip + " Tersedia</font>"
                        );
                    } else if (msg === "NIP-NO") {
                        $("#nipuser").removeClass("object_ok"); // if necessary
                        $("#nipuser").addClass("object_error");
                        $("#statusNIP").html(
                            '<font class="font_object_error">NIP <strong>' +
                            nip +
                            "</strong> sudah digunakan</font>"
                        );
                    } else if (msg === "NIP-Error") {
                        Notiflix.Report.Failure(
                            "Terjadi Kesalahan !!",
                            "Terjadi Kesalahan, silahkan muat ulang halaman !",
                            "Tutup"
                        );
                        $("#statusNIP").html(
                            '<font class="font_object_error"><strong>Terjadi Kesalahan</strong></font>'
                        );
                    }
                },
                error: function(xhr, ajaxOption, thrownError) {
                    Notiflix.Report.Failure(
                        "Terjadi Kesalahan !",
                        "Server tidak merespon permintaan !! - System<br>",
                        "Tutup"
                    );
                }, //error
            });
        } else {
            $("#statusNIP").html(
                '<font class="font_object_error">' +
                "NIP user harus <strong>10</strong> karakter.</font>"
            );
            $("#nipuser").removeClass("object_ok"); // if necessary
            $("#nipuser").addClass("object_error");
        }
    });
});

//Check Nama
$(document).ready(function() {
    $("#nama").on("keyup change", function() {
        var regexname = /^([a-zA-Z\s]{3,30})$/;
        var nama = $("#nama").val();

        if (nama.length >= 3) {
            if (!nama.match(regexname)) {
                // there is a mismatch, hence show the error message
                $("#statusNama").html(
                    '<font class="font_object_error">Nama tidak valid !</font>'
                );
                $("#nama").removeClass("object_ok"); // if necessary
                $("#nama").addClass("object_error");
            } else {
                // else, do not display message
                $("#statusNama").html("");
                $("#nama").removeClass("object_error"); // if necessary
                $("#nama").addClass("object_ok");
            }
        } else {
            $("#statusNama").html(
                '<font class="font_object_error">' +
                "Nama Minimal 3 Karakter dan maksimal 30 karakter</font>"
            );
            $("#nama").removeClass("object_ok"); // if necessary
            $("#nama").addClass("object_error");
        }
    });
});

//Check Email
$(document).ready(function() {
    $("#email").on("keyup change", function() {
        var regexemail = /^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i;
        var email = $("#email").val();

        if (!email.match(regexemail)) {
            // there is a mismatch, hence show the error message
            $("#statusEmail").html(
                '<font class="font_object_error">Email Tidak Valid !</font>'
            );
            $("#email").removeClass("object_ok"); // if necessary
            $("#email").addClass("object_error");
        } else {
            // else, do not display message
            $("#statusEmail").html("");
            $("#email").removeClass("object_error"); // if necessary
            $("#email").addClass("object_ok");
        }
    });
});

//Check Tanggal
$(document).ready(function() {
    $("#level").on("change", function() {
        $("#level").addClass("object_ok");
    });
});

$(function() {
    var editPage = $("#edituser-page");

    editPage.find("form").submit(function(e) {
        // Preventing form submissions. If you implement
        // a backend, you might want to remove this code
        e.preventDefault();
        $.ajax({
            url: rootWebService + "Admin/EditUser/" + nip_encode,
            type: "POST",
            cache: false,
            async: false,
            contentType: false,
            processData: false,
            data: new FormData(this),
            success: function(response) {
                var msg = response.msg;
                var err = response.err;

                if (msg === "OK") {
                    Notiflix.Report.Success(
                        "Pembaharuan Data Berhasil",
                        "Data user berhasil diperbarui !",
                        "Tutup"
                    );
                    $("#input-foto").val("");
                    $("#text-foto").val("");
                    $("#password1").val("");
                    $("#password2").val("");
                    tampil_gambar();
                } else if (msg === "KOSONG") {
                    Notiflix.Notify.Warning("Data tidak boleh kosong/tidak valid !");
                } else if (msg === "SHORT_NAME") {
                    Notiflix.Notify.Warning(
                        "Nama minimal 3 huruf dan maksimal 30 huruf !"
                    );
                } else if (msg === "INVALID_NAME") {
                    Notiflix.Notify.Warning(
                        "Nama tidak boleh menggunakan karakter ilegal !"
                    );
                } else if (msg === "INVALID_NIP") {
                    Notiflix.Notify.Warning("NIP tidak benar !");
                } else if (msg === "NO_UNIQ_NIM") {
                    Notiflix.Notify.Failure("NIM sudah digunakan !");
                } else if (msg === "INVALID_EMAIL") {
                    Notiflix.Notify.Failure("Format email salah !");
                } else if (msg === "FAIL_UPLOAD") {
                    Notiflix.Report.Warning("Terjadi Kesalahan !", err, "Tutup");
                } else if (msg === "SHORT_PASS") {
                    Notiflix.Report.Warning(
                        "Password Terlalu Pendek",
                        "Password yang anda gunakan terlalu pendek, mauskkan minimal 6 karakter !",
                        "Tutup"
                    );
                } else if (msg === "PASS_NOT_SAME") {
                    Notiflix.Report.Warning(
                        "Password tidak sama !",
                        "Password baru dan ulangi password tidak sama !",
                        "Tutup"
                    );
                }
            }, //success
            error: function(xhr, ajaxOption, thrownError) {
                Notiflix.Report.Failure(
                    "Terjadi Kesalahan !",
                    "Server tidak merespon permintaan !! - System<br>",
                    "Tutup"
                );
            }, //error
        }); //ajax
    });
});