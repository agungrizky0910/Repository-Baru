var $ = jQuery.noConflict();

$(document).ready(function() {
    var table;

    table = $("#table-user").DataTable({
        processing: true, //Feature control the processing indicator.
        serverSide: true, //Feature control DataTables' server-side processing mode.
        order: [], //Initial no order.

        // Load data for the table's content from an Ajax source
        ajax: {
            url: rootWebService + "Admin/Tampil_Data_User",
            type: "POST",
        },

        //Set column definition initialisation properties.
        columnDefs: [{
                targets: [-1], //last column
                orderable: false, //set not orderable
            },
            {
                targets: 0,
                className: "text-center",
            },
            {
                targets: 1,
                className: "text-center",
            },
            {
                targets: 3,
                className: "text-center",
            },
            {
                targets: 4,
                className: "text-center",
            },
            {
                targets: 5,
                className: "text-center",
            },
        ],
    });

    function reload_table() {
        table.ajax.reload(null, false); //reload datatable ajax
    }

    //FUNCTION Non-Aktif
    $("#show_data").on("click", ".user_non_aktif", function() {
        var id_nip = $(this).attr("id");
        var data_nama = $(this).attr("data");
        Notiflix.Confirm.Show(
            "Konfrimasi",
            "Anda Yakin ingin Non-Aktifkan " + data_nama + " ?",
            "Ya",
            "Batal",
            function() {
                $.ajax({
                    type: "POST",
                    url: rootWebService + "Admin/DeactivedUser",
                    dataType: "JSON",
                    data: { nip: id_nip },
                    success: function(data) {
                        var msg = data.msg;
                        if (msg === "SUCCESS") {
                            Notiflix.Notify.Success(
                                "Berhasil menonaktifkan " + data_nama + " !"
                            );
                            reload_table();
                        } else if (msg === "FAIL") {
                            Notiflix.Report.Warning(
                                "Terjadi Kesalahan !",
                                "Tidak dapat terhubung ke database, coba beberapa saat lagi <br><br> - System",
                                "Tutup"
                            );
                        }
                    }, //success
                    error: function(xhr, ajaxOption, thrownError) {
                        Notiflix.Report.Failure(
                            "Terjadi Kesalahan !",
                            "Server tidak merespon permintaan !! - System<br>",
                            "Tutup"
                        );
                    }, //error
                });
            },
            false
        );
    });

    //FUNCTION Aktif
    $("#show_data").on("click", ".user_aktif", function() {
        var id_nip = $(this).attr("id");
        var data_nama = $(this).attr("data");
        Notiflix.Confirm.Show(
            "Konfrimasi",
            "Anda Yakin ingin Aktifkan " + data_nama + " ?",
            "Ya",
            "Batal",
            function() {
                $.ajax({
                    type: "POST",
                    url: rootWebService + "Admin/ActivedUser",
                    dataType: "JSON",
                    data: { nip: id_nip },
                    success: function(data) {
                        var msg = data.msg;
                        if (msg === "SUCCESS") {
                            Notiflix.Notify.Success(
                                "Berhasil mengaktifkan " + data_nama + " !"
                            );
                            reload_table();
                        } else if (msg === "FAIL") {
                            Notiflix.Report.Warning(
                                "Terjadi Kesalahan !",
                                "Tidak dapat terhubung ke database, coba beberapa saat lagi <br><br> - System",
                                "Tutup"
                            );
                        }
                    }, //success
                    error: function(xhr, ajaxOption, thrownError) {
                        Notiflix.Report.Failure(
                            "Terjadi Kesalahan !",
                            "Server tidak merespon permintaan !! - System<br>",
                            "Tutup"
                        );
                    }, //error
                });
            },
            false
        );
    });
});