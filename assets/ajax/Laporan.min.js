var $ = jQuery.noConflict();

$(document).ready(function() {
    var table;
    table = $("#laporan").DataTable({
        processing: true, //Feature control the processing indicator.
        serverSide: true, //Feature control DataTables' server-side processing mode.
        order: [], //Initial no order.

        // Load data for the table's content from an Ajax source
        ajax: {
            url: rootWebService + "CaddyMaster/TampilDataLaporan",
            type: "POST",
        },

        //Set column definition initialisation properties.
        columnDefs: [{
                targets: [-1], //last column
                orderable: false, //set not orderable
            },
            {
                targets: 0,
                className: "text-center",
            },
            {
                targets: 2,
                className: "text-center",
            },
            {
                targets: 3,
                className: "text-center",
            },
            {
                targets: 4,
                className: "text-center",
            },
            {
                targets: 5,
                className: "text-center",
            },
            {
                targets: 6,
                className: "text-center",
            },
        ],
    });

    $("#buat-laporan").on("click", function() {
        var bulan = $("select[name=bulan] option").filter(":selected").val();
        var tahun = $("select[name=tahun] option").filter(":selected").val();
        $.ajax({
            type: "POST",
            url: rootWebService + "CaddyMaster/BuatLaporan/" + bulan + "/" + tahun,
            dataType: "JSON",
            success: function(data) {
                var msg = data.msg;
                if (msg === "SUCCESS") {
                    Notiflix.Notify.Success("Laporan Berhasil Dibuat !");
                    table.ajax.reload(null, false); //reload datatable ajax
                } else if (msg === "BELUM-LENGKAP") {
                    Notiflix.Report.Warning(
                        "Terjadi Kesalahan !",
                        "Data penilaian belum semua dinilai !!",
                        "Tutup"
                    );
                } else if (msg === "BELUM-ADA") {
                    Notiflix.Report.Warning(
                        "Terjadi Kesalahan !",
                        "Data penilaian belum ada !!",
                        "Tutup"
                    );
                }
            }, //success
            error: function(xhr, ajaxOption, thrownError) {
                Notiflix.Report.Failure(
                    "Terjadi Kesalahan !",
                    "Server tidak merespon permintaan !! - System<br>",
                    "Tutup"
                );
            }, //error
        });
    });
});