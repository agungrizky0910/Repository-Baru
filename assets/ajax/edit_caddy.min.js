var $ = jQuery.noConflict();
pic1 = new Image(16, 16);
pic1.src = rootWebService + "assets/images/loader.gif";
var pict = rootWebService + "assets/images/loader.gif";
tampil_gambar();

function tampil_gambar() {
    $.ajax({
        type: "GET",
        url: rootWebService + "CaddyMaster/LoadGambar/" + nip_encode,
        async: true,
        dataType: "json",
        success: function(response) {
            var hasil = response.hasil;
            $("#foto-profil").html(hasil);
        },
    });
}
//Check Nama
$(document).ready(function() {
    $("#nama").on("keyup change", function() {
        var regexname = /^([a-zA-Z\s]{3,30})$/;
        var nama = $("#nama").val();

        if (nama.length >= 3) {
            if (!nama.match(regexname)) {
                // there is a mismatch, hence show the error message
                $("#statusNama").html(
                    '<font class="font_object_error">Nama tidak valid !</font>'
                );
                $("#nama").removeClass("object_ok"); // if necessary
                $("#nama").addClass("object_error");
            } else {
                // else, do not display message
                $("#statusNama").html("");
                $("#nama").removeClass("object_error"); // if necessary
                $("#nama").addClass("object_ok");
            }
        } else {
            $("#statusNama").html(
                '<font class="font_object_error">' +
                "Nama Minimal 3 Karakter dan maksimal 30 karakter</font>"
            );
            $("#nama").removeClass("object_ok"); // if necessary
            $("#nama").addClass("object_error");
        }
    });
});

//Check Email
$(document).ready(function() {
    $("#email").on("keyup change", function() {
        var regexemail = /^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i;
        var email = $("#email").val();

        if (!email.match(regexemail)) {
            // there is a mismatch, hence show the error message
            $("#statusEmail").html(
                '<font class="font_object_error">Email Tidak Valid !</font>'
            );
            $("#email").removeClass("object_ok"); // if necessary
            $("#email").addClass("object_error");
        } else {
            // else, do not display message
            $("#statusEmail").html("");
            $("#email").removeClass("object_error"); // if necessary
            $("#email").addClass("object_ok");
        }
    });
});

//Check Nomer HP
$(document).ready(function() {
    $("#tlp").on("keyup change", function() {
        var regextlp = /\(?([0-9]{3})\)?([ .-]?)([0-9]{3})\2([0-9]{4})/;
        var tlp = $("#tlp").val();

        if (!tlp.match(regextlp)) {
            // there is a mismatch, hence show the error message
            $("#statusTlp").html(
                '<font class="font_object_error">Nomer Telepon Tidak Valid !</font>'
            );
            $("#tlp").removeClass("object_ok"); // if necessary
            $("#tlp").addClass("object_error");
        } else {
            // else, do not display message
            $("#statusTlp").html("");
            $("#tlp").removeClass("object_error"); // if necessary
            $("#tlp").addClass("object_ok");
        }
    });
});

//Check Alamat
$(document).ready(function() {
    $("#alamat").on("keyup change", function() {
        var alamat = $("#alamat").val();

        if (alamat.length >= 10) {
            $("#statusAlamat").html("");
            $("#alamat").removeClass("object_error"); // if necessary
            $("#alamat").addClass("object_ok");
        } else {
            $("#statusAlamat").html(
                '<font class="font_object_error">Alamat Harus Lebih Dari 10 Karakter</font>'
            );
            $("#alamat").removeClass("object_ok"); // if necessary
            $("#alamat").addClass("object_error");
        }
    });
});

//Check Tanggal
$(document).ready(function() {
    $("#tanggal").on("keyup change", function() {
        var tanggal = $("#tanggal").val();
        var regexdate = /^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/;

        if (!tanggal.match(regexdate)) {
            $("#tanggal").removeClass("object_ok"); // if necessary
            $("#tanggal").addClass("object_error");
        } else {
            $("#tanggal").removeClass("object_error"); // if necessary
            $("#tanggal").addClass("object_ok");
        }
    });
});

//Check Tanggal
$(document).ready(function() {
    $("#gender").on("change", function() {
        $("#gender").addClass("object_ok");
    });
});

$(function() {
    var loginPage = $("#addcaddy-page");

    loginPage.find("form").submit(function(e) {
        // Preventing form submissions. If you implement
        // a backend, you might want to remove this code
        e.preventDefault();
        $.ajax({
            url: rootWebService + "CaddyMaster/EditCaddy/" + nip_encode,
            type: "POST",
            cache: false,
            async: false,
            contentType: false,
            processData: false,
            data: new FormData(this),
            success: function(response) {
                var msg = response.msg;
                var err = response.err;

                if (msg === "OK") {
                    Notiflix.Report.Success(
                        "Pembaharuan Data Berhasil",
                        "Data caddy berhasil diperbarui !",
                        "Tutup"
                    );
                    $("#input-foto").val("");
                    $("#text-foto").val("");
                    tampil_gambar();
                } else if (msg === "KOSONG") {
                    Notiflix.Notify.Warning("Data tidak boleh kosong/tidak valid !");
                } else if (msg === "SHORT_NAME") {
                    Notiflix.Notify.Warning(
                        "Nama minimal 3 huruf dan maksimal 30 huruf !"
                    );
                } else if (msg === "INVALID_NAME") {
                    Notiflix.Notify.Warning(
                        "Nama tidak boleh menggunakan karakter ilegal !"
                    );
                } else if (msg === "INVALID_EMAIL") {
                    Notiflix.Notify.Failure("Format email salah !");
                } else if (msg === "FAIL_UPLOAD") {
                    Notiflix.Report.Warning("Terjadi Kesalahan !", err, "Tutup");
                } else if (msg === "SHORT_ALAMAT") {
                    Notiflix.Notify.Warning(
                        "Alamat minimal 10 huruf dan maksimal 255 huruf !"
                    );
                }
            }, //success
            error: function(xhr, ajaxOption, thrownError) {
                Notiflix.Report.Failure(
                    "Terjadi Kesalahan !",
                    "Server tidak merespon permintaan !! - System<br>",
                    "Tutup"
                );
            }, //error
        }); //ajax
    });
});