var $ = jQuery.noConflict();
pic1 = new Image(16, 16);
pic1.src = rootWebService + "assets/images/loader.gif";
var pict = rootWebService + "assets/images/loader.gif";

//Check ID Fingerprint
$(document).ready(function() {
    $("#fingerprint").on("keyup change", function() {
        var fp = $("#fingerprint").val();

        if (fp.length >= 1) {
            $("#statusFP").html(
                '<img src="' +
                pict +
                '" align="absmiddle">&nbsp;Memeriksa Ketersediaan...'
            );

            $.ajax({
                type: "POST",
                url: rootWebService + "CaddyMaster/CheckFP",
                data: "fingerprint=" + fp,
                success: function(response) {
                    var msg = response.msg;
                    if (msg === "FP-OK") {
                        $("#fingerprint").removeClass("object_error"); // if necessary
                        $("#fingerprint").addClass("object_ok");
                        $("#statusFP").html(
                            '<font class="font_object_ok">ID Fingerprint ' +
                            fp +
                            " Tersedia</font>"
                        );
                    } else if (msg === "FP-NO") {
                        $("#fingerprint").removeClass("object_ok"); // if necessary
                        $("#fingerprint").addClass("object_error");
                        $("#statusFP").html(
                            '<font class="font_object_error">ID Fingerprint <strong>' +
                            fp +
                            "</strong> sudah digunakan</font>"
                        );
                    } else if (msg === "FP-Error") {
                        Notiflix.Report.Failure(
                            "Terjadi Kesalahan !!",
                            "Terjadi Kesalahan, silahkan muat ulang halaman !",
                            "Tutup"
                        );
                        $("#statusFP").html(
                            '<font class="font_object_error"><strong>Terjadi Kesalahan</strong></font>'
                        );
                    }
                },
                error: function(xhr, ajaxOption, thrownError) {
                    Notiflix.Report.Failure(
                        "Terjadi Kesalahan !",
                        "Server tidak merespon permintaan !! - System<br>",
                        "Tutup"
                    );
                }, //error
            });
        } else {
            $("#statusFP").html(
                '<font class="font_object_error">' +
                "ID Fingerprint harus lebih dari <strong>1</strong> karakter.</font>"
            );
            $("#fingerprint").removeClass("object_ok"); // if necessary
            $("#fingerprint").addClass("object_error");
        }
    });
});

//Check NIP
$(document).ready(function() {
    $("#nipcaddy").on("keyup change", function() {
        var nip = $("#nipcaddy").val();

        if (nip.length == 10) {
            $("#statusNIK").html(
                '<img src="' +
                pict +
                '" align="absmiddle">&nbsp;Memeriksa Ketersediaan...'
            );

            $.ajax({
                type: "POST",
                url: rootWebService + "CaddyMaster/CheckNIP",
                data: "nip=" + nip,
                success: function(response) {
                    var msg = response.msg;
                    if (msg === "NIP-OK") {
                        $("#nipcaddy").removeClass("object_error"); // if necessary
                        $("#nipcaddy").addClass("object_ok");
                        $("#statusNIP").html(
                            '<font class="font_object_ok">NIP ' + nip + " Tersedia</font>"
                        );
                    } else if (msg === "NIP-NO") {
                        $("#nipcaddy").removeClass("object_ok"); // if necessary
                        $("#nipcaddy").addClass("object_error");
                        $("#statusNIP").html(
                            '<font class="font_object_error">NIP <strong>' +
                            nip +
                            "</strong> sudah digunakan</font>"
                        );
                    } else if (msg === "NIP-Error") {
                        Notiflix.Report.Failure(
                            "Terjadi Kesalahan !!",
                            "Terjadi Kesalahan, silahkan muat ulang halaman !",
                            "Tutup"
                        );
                        $("#statusNIP").html(
                            '<font class="font_object_error"><strong>Terjadi Kesalahan</strong></font>'
                        );
                    }
                },
                error: function(xhr, ajaxOption, thrownError) {
                    Notiflix.Report.Failure(
                        "Terjadi Kesalahan !",
                        "Server tidak merespon permintaan !! - System<br>",
                        "Tutup"
                    );
                }, //error
            });
        } else {
            $("#statusNIP").html(
                '<font class="font_object_error">' +
                "NIP caddy harus <strong>10</strong> karakter.</font>"
            );
            $("#nipcaddy").removeClass("object_ok"); // if necessary
            $("#nipcaddy").addClass("object_error");
        }
    });
});

//Check Nama
$(document).ready(function() {
    $("#nama").on("keyup change", function() {
        var regexname = /^([a-zA-Z\s]{3,30})$/;
        var nama = $("#nama").val();

        if (nama.length >= 3) {
            if (!nama.match(regexname)) {
                // there is a mismatch, hence show the error message
                $("#statusNama").html(
                    '<font class="font_object_error">Nama tidak valid !</font>'
                );
                $("#nama").removeClass("object_ok"); // if necessary
                $("#nama").addClass("object_error");
            } else {
                // else, do not display message
                $("#statusNama").html("");
                $("#nama").removeClass("object_error"); // if necessary
                $("#nama").addClass("object_ok");
            }
        } else {
            $("#statusNama").html(
                '<font class="font_object_error">' +
                "Nama Minimal 3 Karakter dan maksimal 30 karakter</font>"
            );
            $("#nama").removeClass("object_ok"); // if necessary
            $("#nama").addClass("object_error");
        }
    });
});

//Check Email
$(document).ready(function() {
    $("#email").on("keyup change", function() {
        var regexemail = /^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i;
        var email = $("#email").val();

        if (!email.match(regexemail)) {
            // there is a mismatch, hence show the error message
            $("#statusEmail").html(
                '<font class="font_object_error">Email Tidak Valid !</font>'
            );
            $("#email").removeClass("object_ok"); // if necessary
            $("#email").addClass("object_error");
        } else {
            // else, do not display message
            $("#statusEmail").html("");
            $("#email").removeClass("object_error"); // if necessary
            $("#email").addClass("object_ok");
        }
    });
});

//Check Nomer HP
$(document).ready(function() {
    $("#tlp").on("keyup change", function() {
        var regextlp = /\(?([0-9]{3})\)?([ .-]?)([0-9]{3})\2([0-9]{4})/;
        var tlp = $("#tlp").val();

        if (!tlp.match(regextlp)) {
            // there is a mismatch, hence show the error message
            $("#statusTlp").html(
                '<font class="font_object_error">Nomer Telepon Tidak Valid !</font>'
            );
            $("#tlp").removeClass("object_ok"); // if necessary
            $("#tlp").addClass("object_error");
        } else {
            // else, do not display message
            $("#statusTlp").html("");
            $("#tlp").removeClass("object_error"); // if necessary
            $("#tlp").addClass("object_ok");
        }
    });
});

//Check Alamat
$(document).ready(function() {
    $("#alamat").on("keyup change", function() {
        var alamat = $("#alamat").val();

        if (alamat.length >= 10) {
            $("#statusAlamat").html("");
            $("#alamat").removeClass("object_error"); // if necessary
            $("#alamat").addClass("object_ok");
        } else {
            $("#statusAlamat").html(
                '<font class="font_object_error">Alamat Harus Lebih Dari 10 Karakter</font>'
            );
            $("#alamat").removeClass("object_ok"); // if necessary
            $("#alamat").addClass("object_error");
        }
    });
});

//Check Tanggal
$(document).ready(function() {
    $("#tanggal").on("keyup change", function() {
        var tanggal = $("#tanggal").val();
        var regexdate = /^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/;

        if (!tanggal.match(regexdate)) {
            $("#tanggal").removeClass("object_ok"); // if necessary
            $("#tanggal").addClass("object_error");
        } else {
            $("#tanggal").removeClass("object_error"); // if necessary
            $("#tanggal").addClass("object_ok");
        }
    });
});

//Check Tanggal
$(document).ready(function() {
    $("#gender").on("change", function() {
        $("#gender").addClass("object_ok");
    });
});

$(function() {
    var loginPage = $("#addcaddy-page");

    loginPage.find("form").submit(function(e) {
        // Preventing form submissions. If you implement
        // a backend, you might want to remove this code
        e.preventDefault();
        $.ajax({
            url: rootWebService + "CaddyMaster/AddCaddy",
            type: "POST",
            cache: false,
            async: false,
            contentType: false,
            processData: false,
            data: new FormData(this),
            success: function(response) {
                var msg = response.msg;
                var err = response.err;

                if (msg === "OK") {
                    Notiflix.Report.Success(
                        "Tambah Caddy Berhasil",
                        "Data Caddy yang baru berhasil ditambahkan",
                        "Tutup"
                    );
                    $("form :input").val("");
                    setTimeout(function() {
                        window.location.href = rootWebService + "CaddyMaster/DataCaddy";
                    }, 3000);
                } else if (msg === "KOSONG") {
                    Notiflix.Notify.Warning("Data tidak boleh kosong/tidak valid !");
                } else if (msg === "SHORT_NAME") {
                    Notiflix.Notify.Warning(
                        "Nama minimal 3 huruf dan maksimal 30 huruf !"
                    );
                } else if (msg === "INVALID_NAME") {
                    Notiflix.Notify.Warning(
                        "Nama tidak boleh menggunakan karakter ilegal !"
                    );
                } else if (msg === "INVALID_NIP") {
                    Notiflix.Notify.Warning("NIP tidak benar !");
                } else if (msg === "NO_UNIQ_NIP") {
                    Notiflix.Notify.Failure("NIP sudah digunakan !");
                } else if (msg === "NO_UNIQ_FP") {
                    Notiflix.Notify.Failure("ID FIngerprint sudah digunakan !");
                } else if (msg === "INVALID_EMAIL") {
                    Notiflix.Notify.Failure("Format email salah !");
                } else if (msg === "FAIL_UPLOAD") {
                    Notiflix.Report.Warning("Terjadi Kesalahan !", err, "Tutup");
                } else if (msg === "SHORT_ALAMAT") {
                    Notiflix.Notify.Warning(
                        "Alamat minimal 10 huruf dan maksimal 255 huruf !"
                    );
                } else if (msg === "SHORT_TLP") {
                    Notiflix.Notify.Warning(
                        "Nomer telepon minimal 8 angka dan maksimal 15 angka !"
                    );
                } else if (msg === "INVALID_TLP") {
                    Notiflix.Notify.Warning("Nomer telepon tidak valid !");
                }
            }, //success
            error: function(xhr, ajaxOption, thrownError) {
                Notiflix.Report.Failure(
                    "Terjadi Kesalahan !",
                    "Server tidak merespon permintaan !! - System<br>",
                    "Tutup"
                );
            }, //error
        }); //ajax
    });
});